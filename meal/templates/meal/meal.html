{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container my-3">
    <div class="row justify-content-end">
        <form method="post">
            {% if date %}
            <input type="hidden" name="kid_id" value="{{ kid_id }}">
            <input type="text" class="h-100" name="datepicker" id="datepicker" value="{{ date }}">
            <button class="btn main_btn" id ="date">선택</button>
            {% endif %}
        </form>
    </div>
    <div class="row mt-3 mb-3 ml-2 kid_pofile">
        <div class="col mt-4 ml-4">
            {% if kid.img %}
            <img class="img" id="profile" src="{{ kid.img.url }}"/>
            {% else %}
            <img class="img" id="profile" src="{% static 'image/kid_profile_default.png' %}"/>
            {% endif %}
        </div>
        <div class="col mt-5 ml-5">
            <div class="row"><h5>이름 : {{kid.name}}</h5></div>
            <div class="row"><h5>생일 : {{kid.birthday | date:"y-m-d" }}</h5></div>
            <div class="row"><h5>키 : {{kid.height}} cm</h5></div>
            <div class="row"><h5>몸무게 : {{kid.weight}} kg</h5></div>
            <div class="row">
                <a class="btn main_btn" href="/user/update/kid_info/">아이 프로필 수정</a>
            </div>
        </div>
        <div class="col mt-1 mr-3">
            <div class="chart-container">
                <canvas id="myChart">
                    <p>Hello Fallback World</p>
                </canvas> 
            </div>
        </div>
    </div>
    <div class="row mt-5 mb-2 description">
        <div class="col ml-3 d-flex justify-content-center"><h5><b>식단 사진</b></h5></div>
        <div class="col ml-3 d-flex justify-content-center"><h5><b>우리 아이 식단</b></h5></div>
        <div class="col ml-3 d-flex justify-content-center"><h5><b>식단 결과</b></h5></div>
    </div>
    <!-- 아침 -->
    <div class="row" id="breakfast_row">
        <div class="col ml-3 frame">
            {% if breakfast_meal.0.img %}
            <div class="row d-flex justify-content-center mt-3 mb-3">
                <img class="img" id="breakfast" src="{{ breakfast_meal.0.img.url }}"/>
            </div>
            {% else %}
            <div class="row d-flex justify-content-center mt-3 mb-3">
                <img class="img" id="breakfast" src="{% static 'image/식판.png' %}" alt="이미지가 존재하지 않습니다."/>
            </div>
            {% endif %}
            {% if breakfast_meal %}
            <div class="row d-flex justify-content-center mb-3">
                <button class="btn sub_btn breakfast_del_btn"><i class="fas fa-redo-alt"></i>&nbsp;다시하기</button>
            </div>
            {% else %}
            <div class="row d-flex justify-content-center mb-3">
                <button class="btn main_btn breakfast_upload mr-1">아침 식단 업로드</button>
            </div>
            {% endif %}
        </div>
        <div class="col ml-3 mb-3 frame" id="breakfast_frame" style="overflow-y: auto;">
            <div class="row mt-3 d-flex justify-content-center"></div>
            <div class="row d-flex justify-content-center mt-3 p-2" id="breakfast_food_form">
                {% if breakfast_meal %}
                    {% for diet in breakfast_diet %}
                    <div class="row ml-1 mr-1 mt-3 mb-3">
                        <input class="col w-100 mr-1" value="{{ diet.nutrition.food }}" name="food" disabled/>
                        <select name="portions" disabled>
                            <option value="{{ diet.portions }}인분">{{ diet.portions }}인분</option>
                        </select>
                        <button class="btn main_btn ml-1 del_food_btn" id="del_breakfast{{ diet.nutrition.food }}_btn" disabled>삭제</button>
                    </div>
                    {% endfor %}
                    <button class="btn sub_btn mt-1 w-75 add_food" disabled>식단 추가</button>
                {% else %}
                <button class="btn sub_btn mt-5 w-75 add_food">식단 추가</button>
                {% endif %}
            </div>
            <div class="row d-flex justify-content-center mt-2 p-2 meal_submit">
                {% if breakfast_diet %}
                <button class="btn main_btn w-75 result_btn" disabled>결과 확인</button>
                {% else %}
                <button class="btn main_btn w-75 result_btn">결과 확인</button>
                {% endif %}
            </div>
        </div>
        <div class="col ml-3 mb-3 frame" style="overflow-y: auto;">
        {% if breakfast_diet %}
            {% if lack_kcal_breakfast != 0 %}
            <div class="row mt-1 mt-5 justify-content-center text-center">
                섭취 칼로리&nbsp;<b style="color: #e8bd00;">{{ lack_kcal_breakfast }}</b><font color="gray">&nbsp;kcal</font>&nbsp;<div style="color: #e8bd00;">(부족)</div>
            </div>
            <div class="row justify-content-center text-center"><small>(일일 권장&nbsp;<b>1400</b><font color="gray">&nbsp;kcal</font>)</small></div>
            <div class="row mt-2 mb-1 justify-content-center">
                <div class="col d-flex justify-content-center">
                    <img class="w-25" src="{% static 'image/못한 식단 아이.png' %}" alt="로고 이미지"/>
                </div>
            </div>
            {% elif good_kcal_breakfast != 0 %}
            <div class="row mt-5 justify-content-center text-center">
                섭취 칼로리&nbsp;<font color="blue"><b>{{ good_kcal_breakfast }}</b></font><font color="gray">&nbsp;kcal</font>&nbsp;<font color="blue">(충분)</font>
            </div>
            <div class="row justify-content-center text-center"><small>(일일 권장&nbsp;<b>1400</b><font color="gray">&nbsp;kcal</font>)</small></div>
            <div class="row mt-2 mb-1 justify-content-center">
                <div class="col d-flex justify-content-center">
                    <img class="w-25" src="{% static 'image/잘한 식단 아이.png' %}" alt="로고 이미지"/>
                </div>
            </div>
            {% elif bad_kcal_breakfast != 0 %}
            <div class="row mt-5 justify-content-center text-center">
                섭취 칼로리&nbsp;<font color="red"><b>{{ bad_kcal_breakfast }}</b></font><font color="gray">&nbsp;kcal</font>&nbsp;<font color="red">(과잉)</font>
            </div>
            <div class="row justify-content-center text-center"><small>(일일 권장&nbsp;<b>1400</b><font color="gray">&nbsp;kcal</font>)</small></div>
            <div class="row mt-2 mb-1 justify-content-center">
                <div class="col d-flex justify-content-center">
                    <img class="w-25" src="{% static 'image/못한 식단 아이.png' %}" alt="로고 이미지"/>
                </div>
            </div>
            {% endif %}
            {% if good_food_breakfast %}
            <div class="row mt-2 mb-1 justify-content-center"><b><충분한 영양소></b></div>
                {% for food in good_food_breakfast %}
                <div class="row justify-content-center text-center">{{ food }}<font color="blue">&nbsp;(충분)</font></div>
                {% endfor %}
            {% else %}
                <div class="row mt-2 mb-2 justify-content-center text-center">아쉬운 식단이네요</div>
            {% endif %}    
            {% if lack_food_breakfast %}    
            <div class="row justify-content-center mt-1">
                <button class="btn sub_btn breakfast_nu_result_btn">부족/과잉 영양성분 보기</button>
            </div>
            {% elif bad_food_breakfast %}    
            <div class="row justify-content-center mt-1">
                <button class="btn sub_btn breakfast_nu_result_btn">부족/과잉 영양성분 보기</button>
            </div>
            {% else %}
            <div class="row justify-content-center mt-1">
                <button class="btn sub_btn" disabled>100점입니다!</button>
            </div>
            {% endif %}
        {% else %}
            <img class="w-100" src="{% static 'image/로고.png' %}" alt="로고 이미지"/>
        {% endif %}
        </div>
    </div>
    <!-- 점심 -->
    <div class="row" id="lunch_row">
        <div class="col ml-3 frame">
            {% if lunch_meal.0.img %}
            <div class="row d-flex justify-content-center mt-3 mb-3">
                <img class="img" id="lunch" src="{{ lunch_meal.0.img.url }}"/>
            </div>
            {% else %}
            <div class="row d-flex justify-content-center mt-3 mb-3">
                <img class="img" id="lunch" src="{% static 'image/식판.png' %}" alt="이미지가 존재하지 않습니다."/>
            </div>
            {% endif %}
            {% if lunch_meal %}
            <div class="row d-flex justify-content-center mb-3">
                <button class="btn sub_btn lunch_del_btn"><i class="fas fa-redo-alt"></i>&nbsp;다시하기</button>
            </div>
            {% else %}
            <div class="row d-flex justify-content-center mb-3">
                <button class="btn main_btn lunch_upload mr-1">점심 식단 업로드</button>
            </div>
            {% endif %}
        </div>
        <div class="col ml-3 mb-3 frame" id="lunch_frame" style="overflow-y: auto;">
            <div class="row mt-3 d-flex justify-content-center"></div>
            <div class="row d-flex justify-content-center mt-3 p-2" id="lunch_food_form">
                {% if lunch_meal %}
                    {% for diet in lunch_diet %}
                    <div class="row ml-1 mr-1 mt-3 mb-3">
                        <input class="col w-100 mr-1" value="{{ diet.nutrition.food }}" name="food" disabled/>
                        <select name="portions" disabled>
                            <option value="{{ diet.portions }}인분">{{ diet.portions }}인분</option>
                        </select>
                        <button class="btn main_btn ml-1 del_food_btn" id="del_breakfast{{ diet.nutrition.food }}_btn" disabled>삭제</button>
                    </div>
                    {% endfor %}
                    <button class="btn sub_btn mt-1 w-75 add_food" disabled>식단 추가</button>
                {% else %}
                <button class="btn sub_btn mt-5 w-75 add_food">식단 추가</button>
                {% endif %}
            </div>
            <div class="row d-flex justify-content-center mt-2 p-2 meal_submit">
                {% if lunch_diet %}
                <button class="btn main_btn w-75 result_btn" disabled>결과 확인</button>
                {% else %}
                <button class="btn main_btn w-75 result_btn">결과 확인</button>
                {% endif %}
            </div>
        </div>
        <div class="col ml-3 mb-3 frame" style="overflow-y: auto;">
        {% if lunch_diet %}
            {% if lack_kcal_lunch != 0 %}
            <div class="row mt-1 mt-5 justify-content-center text-center">
                섭취 칼로리&nbsp;<b style="color: #e8bd00;">{{ lack_kcal_lunch }}</b><font color="gray">&nbsp;kcal</font>&nbsp;<div style="color: #e8bd00;">(부족)</div>
            </div>
            <div class="row justify-content-center text-center"><small>(일일 권장&nbsp;<b>1400</b><font color="gray">&nbsp;kcal</font>)</small></div>
            <div class="row mt-2 mb-1 justify-content-center">
                <div class="col d-flex justify-content-center">
                    <img class="w-25" src="{% static 'image/못한 식단 아이.png' %}" alt="로고 이미지"/>
                </div>
            </div>
            {% elif good_kcal_lunch != 0 %}
            <div class="row mt-5 justify-content-center text-center">
                섭취 칼로리&nbsp;<font color="blue"><b>{{ good_kcal_lunch }}</b></font><font color="gray">&nbsp;kcal</font>&nbsp;<font color="blue">(충분)</font>
            </div>
            <div class="row justify-content-center text-center"><small>(일일 권장&nbsp;<b>1400</b><font color="gray">&nbsp;kcal</font>)</small></div>
            <div class="row mt-2 mb-1 justify-content-center">
                <div class="col d-flex justify-content-center">
                    <img class="w-25" src="{% static 'image/잘한 식단 아이.png' %}" alt="로고 이미지"/>
                </div>
            </div>
            {% elif bad_kcal_lunch != 0 %}
            <div class="row mt-5 justify-content-center text-center">
                섭취 칼로리&nbsp;<font color="red"><b>{{ bad_kcal_lunch }}</b></font><font color="gray">&nbsp;kcal</font>&nbsp;<font color="red">(과잉)</font>
            </div>
            <div class="row justify-content-center text-center"><small>(일일 권장&nbsp;<b>1400</b><font color="gray">&nbsp;kcal</font>)</small></div>
            <div class="row mt-2 mb-1 justify-content-center">
                <div class="col d-flex justify-content-center">
                    <img class="w-25" src="{% static 'image/못한 식단 아이.png' %}" alt="로고 이미지"/>
                </div>
            </div>
            {% endif %}
            {% if good_food_lunch %}
            <div class="row mt-2 mb-1 justify-content-center"><b><충분한 영양소></b></div>
                {% for food in good_food_lunch %}
                <div class="row justify-content-center text-center">{{ food }}<font color="blue">&nbsp;(충분)</font></div>
                {% endfor %}
            {% else %}
                <div class="row mt-2 mb-2 justify-content-center text-center">아쉬운 식단이네요</div>
            {% endif %}
            {% if lack_food_lunch %}
            <div class="row justify-content-center mt-1">
                <button class="btn sub_btn breakfast_nu_result_btn">부족/과잉 영양성분 보기</button>
            </div>
            {% elif bad_food_lunch %}
            <div class="row justify-content-center mt-1">
                <button class="btn sub_btn breakfast_nu_result_btn">부족/과잉 영양성분 보기</button>
            </div>
            {% else %}
            <div class="row justify-content-center mt-1">
                <button class="btn sub_btn" disabled>100점입니다!</button>
            </div>
            {% endif %}
        {% else %}
            <img class="w-100" src="{% static 'image/로고.png' %}" alt="로고 이미지"/>
        {% endif %}
        </div>
    </div>        
    <!-- 저녁 -->
    <div class="row" id="dinner_row">
        <div class="col ml-3 frame">
            {% if dinner_meal.0.img %}
            <div class="row d-flex justify-content-center mt-3 mb-3">
                <img class="img" id="dinner" src="{{ dinner_meal.0.img.url }}"/>
            </div>
            {% else %}
            <div class="row d-flex justify-content-center mt-3 mb-3">
                <img class="img" id="dinner" src="{% static 'image/식판.png' %}" alt="이미지가 존재하지 않습니다."/>
            </div>
            {% endif %}
            {% if dinner_meal %}
            <div class="row d-flex justify-content-center mb-3">
                <button class="btn sub_btn dinner_del_btn"><i class="fas fa-redo-alt"></i>&nbsp;다시하기</button>
            </div>
            {% else %}
            <div class="row d-flex justify-content-center mb-3">
                <button class="btn main_btn dinner_upload mr-1">저녁 식단 업로드</button>
            </div>
            {% endif %}
        </div>
        <div class="col ml-3 mb-3 frame" id="dinner_frame" style="overflow-y: auto;">
            <div class="row mt-3 d-flex justify-content-center"></div>
            <div class="row d-flex justify-content-center mt-3 p-2" id="dinner_food_form">
                {% if dinner_meal %}
                    {% for diet in dinner_diet %}
                    <div class="row ml-1 mr-1 mt-3 mb-3">
                        <input class="col w-100 mr-1" value="{{ diet.nutrition.food }}" name="food" disabled/>
                        <select name="portions" disabled>
                            <option value="{{ diet.portions }}인분">{{ diet.portions }}인분</option>
                        </select>
                        <button class="btn main_btn ml-1 del_food_btn" id="del_breakfast{{ diet.nutrition.food }}_btn" disabled>삭제</button>
                    </div>
                    {% endfor %}
                    <button class="btn sub_btn mt-1 w-75 add_food" disabled>식단 추가</button>
                {% else %}
                <button class="btn sub_btn mt-5 w-75 add_food">식단 추가</button>
                {% endif %}
            </div>
            <div class="row d-flex justify-content-center mt-2 p-2 meal_submit">
                {% if dinner_diet %}
                <button class="btn main_btn w-75 result_btn" disabled>결과 확인</button>
                {% else %}
                <button class="btn main_btn w-75 result_btn">결과 확인</button>
                {% endif %}
            </div>
        </div>
        <div class="col ml-3 mb-3 frame" style="overflow-y: auto;">
        {% if dinner_diet %}
            {% if lack_kcal_dinner != 0 %}
            <div class="row mt-1 mt-5 justify-content-center text-center">
                섭취 칼로리&nbsp;<b style="color: #e8bd00;">{{ lack_kcal_dinner }}</b><font color="gray">&nbsp;kcal</font>&nbsp;<div style="color: #e8bd00;">(부족)</div>
            </div>
            <div class="row justify-content-center text-center"><small>(일일 권장&nbsp;<b>1400</b><font color="gray">&nbsp;kcal</font>)</small></div>
            <div class="row mt-2 mb-1 justify-content-center">
                <div class="col d-flex justify-content-center">
                    <img class="w-25" src="{% static 'image/못한 식단 아이.png' %}" alt="로고 이미지"/>
                </div>
            </div>
            {% elif good_kcal_dinner != 0 %}
            <div class="row mt-5 justify-content-center text-center">
                섭취 칼로리&nbsp;<font color="blue"><b>{{ good_kcal_dinner }}</b></font><font color="gray">&nbsp;kcal</font>&nbsp;<font color="blue">(충분)</font>
            </div>
            <div class="row justify-content-center text-center"><small>(일일 권장&nbsp;<b>1400</b><font color="gray">&nbsp;kcal</font>)</small></div>
            <div class="row mt-2 mb-1 justify-content-center">
                <div class="col d-flex justify-content-center">
                    <img class="w-25" src="{% static 'image/잘한 식단 아이.png' %}" alt="로고 이미지"/>
                </div>
            </div>
            {% elif bad_kcal_dinner != 0 %}
            <div class="row mt-5 justify-content-center text-center">
                섭취 칼로리&nbsp;<font color="red"><b>{{ bad_kcal_dinner }}</b></font><font color="gray">&nbsp;kcal</font>&nbsp;<font color="red">(과잉)</font>
            </div>
            <div class="row justify-content-center text-center"><small>(일일 권장&nbsp;<b>1400</b><font color="gray">&nbsp;kcal</font>)</small></div>
            <div class="row mt-2 mb-1 justify-content-center">
                <div class="col d-flex justify-content-center">
                    <img class="w-25" src="{% static 'image/못한 식단 아이.png' %}" alt="로고 이미지"/>
                </div>
            </div>
            {% endif %}
            {% if good_food_dinner %}
            <div class="row mt-2 mb-1 justify-content-center"><b><충분한 영양소></b></div>
                {% for food in good_food_dinner %}
                <div class="row justify-content-center text-center">{{ food }}<font color="blue">&nbsp;(충분)</font></div>
                {% endfor %}
            {% else %}
                <div class="row mt-2 mb-2 justify-content-center text-center">아쉬운 식단이네요</div>
            {% endif %}
            {% if lack_food_dinner %}
            <div class="row justify-content-center mt-1">
                <button class="btn sub_btn breakfast_nu_result_btn">부족/과잉 영양성분 보기</button>
            </div>
            {% elif bad_food_dinner %}
            <div class="row justify-content-center mt-1">
                <button class="btn sub_btn breakfast_nu_result_btn">부족/과잉 영양성분 보기</button>
            </div>
            {% else %}
            <div class="row justify-content-center mt-1">
                <button class="btn sub_btn" disabled>100점입니다!</button>
            </div>
            {% endif %}
        {% else %}
            <img class="w-100" src="{% static 'image/로고.png' %}" alt="로고 이미지"/>
        {% endif %}
        </div>
    </div>
</div>
<!-- 모달 -->
<div class="modal fade" id="breakfast_modal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <b>아침 식단 업로드</b>
                <button type="button" class="close" data-dismiss="modal">
                    <span>x</span>
                </button>
            </div>
            <form id="breakfast_form" class="modal-body text-center" method="post" enctype="multipart/form-data">
                <img id="breakfast_previewImg" src="{% static 'image/식판.png' %}" alt="이미지가 존재하지 않습니다."/>
                <label for="breakfast_fileBtn" class="btn main_btn">
                    <i class="fa-solid fa-upload"></i>&nbsp;업로드
                </label>
                <input id="breakfast_fileBtn" type="file" accept=".jpg, .png" style="display:none"/>
            </form>
            <div class="modal-footer justify-content-center">
                <button class="btn sub_btn" data-dismiss="modal">취소</button>
                <button class="btn main_btn" id="breakfast_upload">&nbsp;&nbsp;&nbsp;확인&nbsp;&nbsp;&nbsp;</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="lunch_modal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <b>점심 식단 업로드</b>
                <button type="button" class="close" data-dismiss="modal">
                    <span>x</span>
                </button>
            </div>
            <form id="lunch_form"  class="modal-body text-center">
                <img id="lunch_previewImg" src="{% static 'image/식판.png' %}" alt="이미지가 존재하지 않습니다."/>
                <label for="lunch_fileBtn" class="btn main_btn">
                    <i class="fa-solid fa-upload"></i>&nbsp;업로드
                </label>
                <input id="lunch_fileBtn" type="file" accept=".jpg, .png" style="display:none"/>
            </form>
            <div class="modal-footer justify-content-center">
                <button class="btn sub_btn" data-dismiss="modal">취소</button>
                <button class="btn main_btn" id="lunch_upload">&nbsp;&nbsp;&nbsp;확인&nbsp;&nbsp;&nbsp;</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="dinner_modal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <b>저녁 식단 업로드</b>
                <button type="button" class="close" data-dismiss="modal">
                    <span>x</span>
                </button>
            </div>
            <form id="dinner_form"  class="modal-body text-center">
                <img id="dinner_previewImg" src="{% static 'image/식판.png' %}" alt="이미지가 존재하지 않습니다."/>
                <label for="dinner_fileBtn" class="btn main_btn">
                    <i class="fa-solid fa-upload"></i>&nbsp;업로드
                </label>
                <input id="dinner_fileBtn" type="file" accept=".jpg, .png" style="display:none"/>
            </form>
            <div class="modal-footer justify-content-center">
                <button class="btn sub_btn" data-dismiss="modal">취소</button>
                <button class="btn main_btn" id="dinner_upload">&nbsp;&nbsp;&nbsp;확인&nbsp;&nbsp;&nbsp;</button>
            </div>
        </div>
    </div>
</div>
<!-- 음식 검색 모달 -->
<div class="modal fade" id="food_search" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <b>음식 검색</b>
                <button type="button" class="close" data-dismiss="modal">
                    <span>x</span>
                </button>
            </div>
            <div class="modal-body text-center">
                <div class="row">
                    <div class="col d-flex justify-content-end">
                        <input type="text" class="text-center w-50 ml-3 food_input" placeholder="한 글자 이상을 입력하세요."/>
                        <button class="btn search_food"><i class="fa-solid fa-magnifying-glass"></i></button>
                    </div>
                </div>
                <div class="row mt-3 mb-3 search_result" style="overflow-y: auto;">
                    <div class="row mt-2 mb-3 ml-4 picked_food_list"></div>
                    <table class="w-100 food_table"></table>
                </div>
            </div>
            <div class="modal-footer justify-content-center">
                <button class="btn sub_btn" data-dismiss="modal">취소</button>
                <button class="btn main_btn" id="add_Btn">&nbsp;&nbsp;&nbsp;추가&nbsp;&nbsp;&nbsp;</button>
            </div>
        </div>
    </div>
</div>
<!-- 다시하기 모달 -->
<div class="modal fade" id="re_modal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <b>다시하기</b>
                <button type="button" class="close" data-dismiss="modal">
                    <span>x</span>
                </button>
            </div>
            <div class="modal-body text-center">
                <b><font color="red">정말 다시겠습니까 ?</font></b><br>
                <small>다시 할 경우 해당 식단의 기존 정보들은 저장되지 않습니다.</small>
            </div>
            <div class="modal-footer justify-content-center">
                <button class="btn sub_btn" data-dismiss="modal">취소</button>
                <button class="btn main_btn" id="re_btn">&nbsp;&nbsp;&nbsp;다시하기&nbsp;&nbsp;&nbsp;</button>
            </div>
        </div>
    </div>
</div>
<!-- 아침 식단 부족/과잉 영양성분 모달 -->
<div class="modal fade" id="breakfast_nu_modal" tabindex="-1">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <b>부족/과잉 영양성분</b>
                <button type="button" class="close" data-dismiss="modal">
                    <span>x</span>
                </button>
            </div>
            <div class="modal-body text-center nu_body">
                {% if lack_kcal_breakfast != 0 %}
                <div class="row mt-2 justify-content-center text-center">
                    섭취 칼로리&nbsp;<b style="color: #e8bd00;">{{ lack_kcal_breakfast }}</b><font color="gray">&nbsp;kcal</font>&nbsp;<div style="color: #e8bd00;">(부족)</div>
                </div>
                <div class="row justify-content-center text-center"><small>(일일 권장&nbsp;<b>1400</b><font color="gray">&nbsp;kcal</font>)</small></div>
                <div class="row mt-2 mb-1 justify-content-center">
                    <div class="col d-flex justify-content-center">
                        <img class="w-25" src="{% static 'image/못한 식단 아이.png' %}" alt="로고 이미지"/>
                    </div>
                </div>
                {% elif good_kcal_breakfast != 0 %}
                <div class="row mt-2 justify-content-center text-center">
                    섭취 칼로리&nbsp;<font color="blue"><b>{{ good_kcal_breakfast }}</b></font><font color="gray">&nbsp;kcal</font>&nbsp;<font color="blue">(충분)</font>
                </div>
                <div class="row justify-content-center text-center"><small>(일일 권장&nbsp;<b>1400</b><font color="gray">&nbsp;kcal</font>)</small></div>
                <div class="row mt-2 mb-1 justify-content-center">
                    <div class="col d-flex justify-content-center">
                        <img class="w-25" src="{% static 'image/잘한 식단 아이.png' %}" alt="로고 이미지"/>
                    </div>
                </div>
                {% elif bad_kcal_breakfast != 0 %}
                <div class="row mt-2 justify-content-center text-center">
                    섭취 칼로리&nbsp;<font color="red"><b>{{ bad_kcal_breakfast }}</b></font><font color="gray">&nbsp;kcal</font>&nbsp;<font color="red">(과잉)</font>
                </div>
                <div class="row justify-content-center text-center"><small>(일일 권장&nbsp;<b>1400</b><font color="gray">&nbsp;kcal</font>)</small></div>
                <div class="row mt-2 mb-1 justify-content-center">
                    <div class="col d-flex justify-content-center">
                        <img class="w-25" src="{% static 'image/못한 식단 아이.png' %}" alt="로고 이미지"/>
                    </div>
                </div>
                {% endif %}
                {% if lack_food_breakfast %}
                    {% for food in lack_food_breakfast %}
                    <div class="row justify-content-center text-center">{{ food }}<div style="color: #e8bd00;">&nbsp;(부족)</div></div>
                    {% endfor %}
                {% endif %}
                {% if bad_food_breakfast %}
                    {% for food in bad_food_breakfast %}
                    <div class="row justify-content-center text-center">{{ food }}<font color="red">&nbsp;(과잉)</font></div>
                    {% endfor %}
                {% endif %} 
            </div>
            <div class="modal-footer justify-content-center">
                <button class="btn main_btn" data-dismiss="modal">확인</button>
            </div>
        </div>
    </div>
</div>
<!-- 점심 식단 부족/과잉 영양성분 모달 -->
<div class="modal fade" id="lunch_nu_modal" tabindex="-1">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <b>부족/과잉 영양성분</b>
                <button type="button" class="close" data-dismiss="modal">
                    <span>x</span>
                </button>
            </div>
            <div class="modal-body text-center nu_body">
                {% if lack_kcal_lunch != 0 %}
                <div class="row mt-2 justify-content-center text-center">
                    섭취 칼로리&nbsp;<b style="color: #e8bd00;">{{ lack_kcal_lunch }}</b><font color="gray">&nbsp;kcal</font>&nbsp;<div style="color: #e8bd00;">(부족)</div>
                </div>
                <div class="row justify-content-center text-center"><small>(일일 권장&nbsp;<b>1400</b><font color="gray">&nbsp;kcal</font>)</small></div>
                <div class="row mt-2 mb-1 justify-content-center">
                    <div class="col d-flex justify-content-center">
                        <img class="w-25" src="{% static 'image/못한 식단 아이.png' %}" alt="로고 이미지"/>
                    </div>
                </div>
                {% elif good_kcal_lunch != 0 %}
                <div class="row mt-2 justify-content-center text-center">
                    섭취 칼로리&nbsp;<font color="blue"><b>{{ good_kcal_lunch }}</b></font><font color="gray">&nbsp;kcal</font>&nbsp;<font color="blue">(충분)</font>
                </div>
                <div class="row justify-content-center text-center"><small>(일일 권장&nbsp;<b>1400</b><font color="gray">&nbsp;kcal</font>)</small></div>
                <div class="row mt-2 mb-1 justify-content-center">
                    <div class="col d-flex justify-content-center">
                        <img class="w-25" src="{% static 'image/잘한 식단 아이.png' %}" alt="로고 이미지"/>
                    </div>
                </div>
                {% elif bad_kcal_lunch != 0 %}
                <div class="row mt-2 justify-content-center text-center">
                    섭취 칼로리&nbsp;<font color="red"><b>{{ bad_kcal_lunch }}</b></font><font color="gray">&nbsp;kcal</font>&nbsp;<font color="red">(과잉)</font>
                </div>
                <div class="row justify-content-center text-center"><small>(일일 권장&nbsp;<b>1400</b><font color="gray">&nbsp;kcal</font>)</small></div>
                <div class="row mt-2 mb-1 justify-content-center">
                    <div class="col d-flex justify-content-center">
                        <img class="w-25" src="{% static 'image/못한 식단 아이.png' %}" alt="로고 이미지"/>
                    </div>
                </div>
                {% endif %}
                {% if lack_food_lunch %}
                    {% for food in lack_food_lunch %}
                    <div class="row justify-content-center text-center">{{ food }}<div style="color: #e8bd00;">&nbsp;(부족)</div></div>
                    {% endfor %}
                {% endif %}
                {% if bad_food_lunch %}
                    {% for food in bad_food_lunch %}
                    <div class="row justify-content-center text-center">{{ food }}<font color="red">&nbsp;(과잉)</font></div>
                    {% endfor %}
                {% endif %} 
            </div>
            <div class="modal-footer justify-content-center">
                <button class="btn main_btn" data-dismiss="modal">확인</button>
            </div>
        </div>
    </div>
</div>
<!-- 저녁 식단 부족/과잉 영양성분 모달 -->
<div class="modal fade" id="dinner_nu_modal" tabindex="-1">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <b>부족/과잉 영양성분</b>
                <button type="button" class="close" data-dismiss="modal">
                    <span>x</span>
                </button>
            </div>
            <div class="modal-body text-center nu_body">
                {% if lack_kcal_dinner != 0 %}
                <div class="row mt-2 justify-content-center text-center">
                    섭취 칼로리&nbsp;<b style="color: #e8bd00;">{{ lack_kcal_dinner }}</b><font color="gray">&nbsp;kcal</font>&nbsp;<div style="color: #e8bd00;">(부족)</div>
                </div>
                <div class="row justify-content-center text-center"><small>(일일 권장&nbsp;<b>1400</b><font color="gray">&nbsp;kcal</font>)</small></div>
                <div class="row mt-2 mb-1 justify-content-center">
                    <div class="col d-flex justify-content-center">
                        <img class="w-25" src="{% static 'image/못한 식단 아이.png' %}" alt="로고 이미지"/>
                    </div>
                </div>
                {% elif good_kcal_dinner != 0 %}
                <div class="row mt-2 justify-content-center text-center">
                    섭취 칼로리&nbsp;<font color="blue"><b>{{ good_kcal_dinner }}</b></font><font color="gray">&nbsp;kcal</font>&nbsp;<font color="blue">(충분)</font>
                </div>
                <div class="row justify-content-center text-center"><small>(일일 권장&nbsp;<b>1400</b><font color="gray">&nbsp;kcal</font>)</small></div>
                <div class="row mt-2 mb-1 justify-content-center">
                    <div class="col d-flex justify-content-center">
                        <img class="w-25" src="{% static 'image/잘한 식단 아이.png' %}" alt="로고 이미지"/>
                    </div>
                </div>
                {% elif bad_kcal_dinner != 0 %}
                <div class="row mt-2 justify-content-center text-center">
                    섭취 칼로리&nbsp;<font color="red"><b>{{ bad_kcal_dinner }}</b></font><font color="gray">&nbsp;kcal</font>&nbsp;<font color="red">(과잉)</font>
                </div>
                <div class="row justify-content-center text-center"><small>(일일 권장&nbsp;<b>1400</b><font color="gray">&nbsp;kcal</font>)</small></div>
                <div class="row mt-2 mb-1 justify-content-center">
                    <div class="col d-flex justify-content-center">
                        <img class="w-25" src="{% static 'image/못한 식단 아이.png' %}" alt="로고 이미지"/>
                    </div>
                </div>
                {% endif %}
                {% if lack_food_dinner %}
                    {% for food in lack_food_dinner %}
                    <div class="row justify-content-center text-center">{{ food }}<div style="color: #e8bd00;">&nbsp;(부족)</div></div>
                    {% endfor %}
                {% endif %}
                {% if bad_food_dinner %}
                    {% for food in bad_food_dinner %}
                    <div class="row justify-content-center text-center">{{ food }}<font color="red">&nbsp;(과잉)</font></div>
                    {% endfor %}
                {% endif %} 
            </div>
            <div class="modal-footer justify-content-center">
                <button class="btn main_btn" data-dismiss="modal">확인</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block style %}
<style>
.container, .modal {
  font-family : 'Cafe24Dongdong'
}

#datepicker, input[name=food], select {
    border: #ff7449 1px solid;
    border-radius: 5px;
}

#datepicker {
    text-align: center;
}

.ui-widget {
	font-family: Cafe24Dongdong;
	font-size: 1em;
}

.ui-widget input,
.ui-widget select,
.ui-widget textarea,
.ui-widget button {
	font-family: Cafe24Dongdong;
	font-size: 1em;
}

.ui-widget-content {
	border: 1px solid #dddddd;
	background: #ffede5;
	color: #333333;
}

.ui-widget-header {
	border: 1px solid #ff7349;
	background: #ff926c;
	color: #333333;
	font-weight: bold;
}

.ui-state-hover,
.ui-widget-content .ui-state-hover,
.ui-widget-header .ui-state-hover,
.ui-state-focus,
.ui-widget-content .ui-state-focus,
.ui-widget-header .ui-state-focus,
.ui-button:hover,
.ui-button:focus {
	border: 1px solid #cccccc;
	background: #ffede5;
	font-weight: normal;
	color: #2b2b2b;
}

.ui-state-active,
.ui-widget-content .ui-state-active,
.ui-widget-header .ui-state-active,
a.ui-button:active,
.ui-button:active,
.ui-button.ui-state-active:hover {
	border: 1px solid #ff6030;
	background: #ff7449;
	font-weight: normal;
	color: #ffffff;
}

.kid_pofile {
    border: #ff7449 2px solid;
    border-radius: 20px;
}

#profile {
    width: 14rem;
    height: 13rem;
    border-radius: 25%;
    object-fit: cover;
}

#myChart {
    width: 35vw;
}

#breakfast_previewImg, #lunch_previewImg, #dinner_previewImg {
    margin: 1rem;
    width: 18rem;
    height: 15rem;
    border: #ff7449 1px solid;
    border-radius: 20px;
}

.description {
    color: #808080;
}

.frame {
    height: 20rem;
    border: #ff7449 2px solid;
    border-radius: 20px;
}

.img {
    width: 75%;
    height: 15rem;
    border-radius: 20px;
}

.picked_food_list {
    height: 1rem;
}

.picked_food {
    border: #ff7449 1px solid;
    border-radius: 5%;
    background-color: #fcc5ae;
    height: 2rem;
}

/* 모달 */
.search_result {
    height: 20rem;
    border-top: #ff7449 1px solid;
}

.food_input, .search_food {
    border: #ff7449 1px solid;
    border-radius: 5px;
}

</style>
{% endblock %}

{% block script %}
<script>
function modal_show(meal) {
    let meal_time

    if (meal == 'breakfast') meal_time = '아침'
    else if (meal == 'lunch') meal_time = '점심'
    else meal_time = '저녁'
    
    if ($('#' + meal).attr('src') != "{% static 'image/식판.png' %}") {
        $('#' + meal + '_modal img').attr('src', $('#' + meal).attr('src'))
    } else {
        $('#' + meal + '_modal img').attr('src', "{% static 'image/식판.png' %}")
    }

    $('#' + meal + '_fileBtn').val('')
    $('#' + meal + '_modal').modal('show')
}

function meal_upload(meal) {
    if (!$('#' + meal + '_fileBtn').val())
            $('#' + meal + '_mod').attr('disabled', 'disabled')

    $('#' + meal + '_fileBtn').change(function() {
        if(this.files[0]) {
            let reader = new FileReader()
            reader.readAsDataURL(this.files[0])
    
            reader.addEventListener('load', function() {
                $('#' + meal + '_previewImg').attr('src', reader.result)
                readerResult = reader.result
            }, false)
        }
    })

    $('#' + meal + '_upload').click(function() {
        meal_img = $('#' + meal + '_previewImg').attr('src')
        $('#' + meal).attr('src', meal_img)

        let form = $('#' + meal + '_form')[0]
        let formData = new FormData(form)

        formData.append('meal_img', $('#' + meal + '_fileBtn')[0].files[0])  // 식단 이미지 사진

        $.ajax({
            url: 'upload',
            method: 'post',
            enctype: 'multipart/form-data',
            data: formData,
            contentType: false,
            processData: false,
        }).done(function(results) {
            results = results.replaceAll(',', '')
            results = results.split(' ')
            results_length = results.pop()
            if (results) {
                $.each(results, function(idx, food) {
                    add_food_place = '#' + meal + '_food_form .add_food'
                    $(add_food_place).before(
                        '<div class="row ml-1 mr-1 mt-3 mb-3">' +
                            '<input class="col w-100 mr-1" disabled value=' + food + ' name="food"/>' +
                            '<select name="portions">' +
                                '<option value="1인분">1인분</option>' +
                                '<option value="0.5인분">0.5인분</option>' +
                                '<option value="1.5인분">1.5인분</option>' +
                            '</select>' +
                            '<button class="btn main_btn ml-1 del_food_btn" id="del_' + meal + food + '_btn">삭제</button>' +
                        '</div>'
                    )
                })
            }
        })
        $('#' + meal + '_modal').modal('hide')
    })
}

function del_meal_diet(meal) {
    let regdate = $('#datepicker').val()
    let meal_time

    if (meal == 'breakfast') meal_time = '아침'
    else if (meal == 'lunch') meal_time = '점심'
    else meal_time = '저녁'

    $('#re_modal').modal('show')
    $('#re_btn').click(function() {
        $.ajax({
            url: 'del_meal_diet',
            method: 'delete',
            data: JSON.stringify({
                regdate: regdate,
                meal_time: meal_time,
                kid_id: sessionStorage.getItem('kid_id')
            }),
            contentType: 'application/json'
        }).done(function(result) {
            $('#' + meal).attr('src', "{% static 'image/식판.png' %}")
            $('#' + meal +'_food_form div').remove()
            $('#' + meal +'_frame .add_food').removeAttr('disabled')
            $('#' + meal +'_frame .result_btn').removeAttr('disabled')
            $('#re_modal').modal('hide')
            window.location.reload()
        })
    })
}

$(document).ready(function() {
    console.log(sessionStorage.getItem('kid_id'))
    // 데이트피커
    //input을 datepicker로 선언
    $("#datepicker").datepicker({
        dateFormat: 'yy-mm-dd', //달력 날짜 형태
        showOtherMonths: true, //빈 공간에 현재월의 앞뒤월의 날짜를 표시
        selectOtherMonths: true,
        showMonthAfterYear:true, // 월- 년 순서가아닌 년도 - 월 순서
        changeYear: true, //option값 년 선택 가능
        changeMonth: true, //option값  월 선택 가능                           
        yearSuffix: "년", //달력의 년도 부분 뒤 텍스트
        monthNamesShort: ['1월','2월','3월','4월','5월','6월','7월','8월','9월','10월','11월','12월'], //달력의 월 부분 텍스트
        monthNames: ['1월','2월','3월','4월','5월','6월','7월','8월','9월','10월','11월','12월'], //달력의 월 부분 Tooltip
        dayNamesMin: ['일','월','화','수','목','금','토'], //달력의 요일 텍스트
        dayNames: ['일요일','월요일','화요일','수요일','목요일','금요일','토요일'], //달력의 요일 Tooltip
        minDate: "-5Y", //최소 선택일자(-1D:하루전, -1M:한달전, -1Y:일년전)
        maxDate: "+0d" //최대 선택일자(+1D:하루후, -1M:한달후, -1Y:일년후)  
    })

    //차트

    let canvas = document.getElementById('myChart')
    let ctx = canvas.getContext('2d')
    let labels = ['칼로리','탄수화물','단백질','지방','나트륨','칼슘','철분']
    let int = {{ intake|safe }}

    let recom = [1400,180,20,65,1200,600,7]
    let recom2 = ['Kcal','g','g','g','mg','mg','mg']
    
    let intake1 = []
    intake1.push(int.breakfast_per)
    intake1.push(int.lunch_per)
    intake1.push(int.dinner_per)

    let intake2 = []
    intake2.push(int.breakfast)
    intake2.push(int.lunch)
    intake2.push(int.dinner)

  
    let data = {
      labels: labels,
        datasets: [{
          label: '아침',
          data: intake1[0],
          backgroundColor: [
            'rgba(250,128,114)'
          ],
          hoverBackgroundColor: [
            'rgb(250,128,114,0.5)'
          ]
        },{
          label: '점심',
          data: intake1[1],
          backgroundColor: [
            'rgba(128,0,128)'
          ],
          hoverBackgroundColor: [
            'rgb(128,0,128,0.5)'
          ]
        },{
          label: '저녁',
          data: intake1[2],
          backgroundColor: [
            'rgba(135,206,235)'
          ],
          hoverBackgroundColor: [
            'rgb(135,206,235,0.5)'
          ]
        }]
    }
  
    let options = {
        responsive: false,
        
        indexAxis: 'y',

        plugins: {

            title: {
            display: true,
            position: 'bottom',
            text: '일일 권장섭취량 (%)'
            },


    
            tooltip: {
                enabled: true,
                titleAlign: 'center',
                bodyAlign: 'center',
                footerAlign: 'center',
                xAlign: 'left',
                callbacks: {
                    afterTitle: function(context) {
                        i = context[0].dataIndex
                        return "권장섭취량 : "+recom[i]+recom2[i]
                    },
                    label: function(context) {
                        
                        i = context.dataIndex
                        j = context.datasetIndex
                        return String(Math.round(intake2[j][i])) + recom2[i] + " ( " + String(Math.round(intake1[j][i])) + "% )"
                    },
                    footer: function(contexts) {

                        i = contexts[0].dataIndex

                        x=0
                        y=0
                        
                        for(j=0;j<3;j++){
                            if(intake2[j]){
                                x+=intake2[j][i]
                            }
                            if(intake1[j]){
                                y+=intake1[j][i]
                            }
                        }
                        
                        return "총 : "+String(Math.round(x)) + recom2[i] + " ( " + String(Math.round(y)) + "% )"
                    },
                },
                footerColor: function(context) {

                    if(context.tooltipItems[0]){
                        i = context.tooltipItems[0].dataIndex

                        y=0;

                        for(k=0;k<3;k++){
                            if(intake1[k]){
                                y+=intake1[k][i]
                            }
                        }
                        
                        if( y > 125){
                            return 'rgb(255,0,0,0.9)';
                        }
                        else if(y <75){
                            return 'rgb(255,255,0,0.8)';
                        }
                        else {
                            return 'rgb(0,255,0,0.8)';
                        }
                    }
                    else return 'white';
                },
                backgroundColor: 'rgb(0,0,0,0.75)'
            },
        },
  
        scales: {
          x: {
            stacked: true,
            ticks: {
              callback: function(value, index, ticks) {
                return value+'%'
              }
            },
            grid: {
                lineWidth: 1
            },
          },
          y: {
            stacked: true,
            grid: {
                lineWidth: 1
            },
          },
        }
    }
  
    let myChart = new Chart(ctx, {
      type: 'bar',
      data: data,
  
      options: options
  
    })

    
    $('.breakfast_upload').click(function() {
        modal_show('breakfast')        
        meal_upload('breakfast')
    })

    $('.lunch_upload').click(function() {
        modal_show('lunch')
        meal_upload('lunch')
    })

    $('.dinner_upload').click(function() {
        modal_show('dinner')
        meal_upload('dinner')
    })

    $('.breakfast_del_btn').click(function() {
        del_meal_diet('breakfast')
    })

    $('.lunch_del_btn').click(function() {
        del_meal_diet('lunch')
    })

    $('.dinner_del_btn').click(function() {
        del_meal_diet('dinner')
    })

    // 검색 모달 띄우고 결과값 들어가게
    $('.add_food').click(function() {
        
        // 들어갈 폼 - 전역변수 선언
        window.parent_food_form = $(this).parent().attr('id')
        window.food_list = []  // 전역변수 선언

        $('.food_table').empty()
        $('.picked_food_list').empty()
        $.ajax({
            url: 'food_list',
            method: 'post',
        }).done(function(foods) {
            if (foods) {
                foods = foods.split(' ')
                $.each(foods, function(idx, food) {
                    if (food) {
                        $('.food_table').append(`<div class="mb-3 ml-5" style="text-align: start;"><input type="checkbox" name="food" value="${food}" id="${food}"/> ${food}</div>`)
                    }
                })
            }
        })
        $('.food_input').val('')
        $('#food_search').modal('show')
    })

    // 실시간 검색
    let old_val
    $(".food_input").on("propertychange change keyup paste input", function(){
        let current_val = $(this).val()
        if (current_val == old_val) {
            return
        }
        old_val = current_val
        $.ajax({
            url: 'search_food_list',
            method: 'post',
            data: JSON.stringify({
                search_data: $('.food_input').val()
            }),
            contentType: 'application/json'
        }).done(function(foods) {
            $('.food_table').empty()
            if (foods) {
                foods = foods.split(' ')
                $.each(foods, function(idx, food) {
                    if (food) {
                        $('.food_table').append(`<div class="mb-3 ml-5" style="text-align: start;"><input type="checkbox" name="food" value="${food}" id="${food}"/> ${food}</div>`)
                    }
                })
            } else if (!foods) {
                $('.food_table').append('<font class="d-flex justify-content-center" color="red">『' + $('.food_input').val() + '』에 대한 검색 결과가 존재하지 않습니다.</font>')
            }
        })
    })

    $('.search_food').click(function() {
        if (!($('.food_input').val())) {
            $('.food_table').empty()
            $('.food_table').append('<font class="d-flex justify-content-center" color="red">한 글자 이상 검색해주세요.</font>')
        }
    })
    
    // 검색창에서 음식 선택
    $(document).on('click', 'input:checkbox', function() {
        food_id = $(this).attr('id')
        check_id = '#' + food_id
        if($(check_id).is(':checked')) {
            $('.picked_food_list').append(`<button class="mr-1 p-1 picked_food" id="${food_id}"><small>${food_id} x</small></button>`)
            window.food_list.push(food_id)
        }
    })

    // 검색창에서 선택된 음식 삭제 & 체크박스 해제
    $(document).on('click', '.picked_food', function() {
        food_id = $(this).attr('id')
        picked_id = '#' + food_id
        $('input:checkbox[id="' + food_id +'"]').prop('checked', false)
        $('button' + picked_id).remove()

        // 전역변수에서도 해당 음식 삭제
        for(let i = 0; i < window.food_list.length; i++) {
            if (window.food_list[i] === food_id) {
                window.food_list.splice(i, 1)
                i--
            }
        }
    })

    // 음식 검색 후 음식 추가
    $('#add_Btn').click(function() {
        add_food_place = '#' + window.parent_food_form + ' .add_food'
        cnt = $('.picked_food_list').children().length

        for (let i = 0; i < cnt; i++) {
            $(add_food_place).before(
                '<div class="row ml-1 mr-1 mt-3 mb-3">' +
                    '<input class="col w-100 mr-1" disabled value=' + window.food_list[i] + ' name="food"/>' +
                    '<select name="portions">' +
                        '<option value="1인분">1인분</option>' +
                        '<option value="0.5인분">0.5인분</option>' +
                        '<option value="1.5인분">1.5인분</option>' +
                    '</select>' +
                    '<button class="btn main_btn ml-1 del_food_btn" id="del_' + window.parent_food_form + window.food_list[i] + '_btn">삭제</button>' +
                '</div>'
            )
        }
        $('#food_search').modal('hide')
    })
    // 음식 삭제
    $(document).on('click', '.del_food_btn', function() {
        btn_id = '#' + $(this).attr('id')
        $(btn_id).parent().remove()
    })

    // 식단 결과 확인 - meal, diet 객체 생성
    $('.result_btn').click(function() {
        food_form = '#' + $(this).parent().parent().attr('id') + ' div:nth-child(2)'
        console.log(food_form)
        food_row = '#' + $(food_form).attr('id') + ' input'
        food_row_portions = '#' + $(food_form).attr('id') + ' select option:selected'
        food_result = []
        portions = []

        if ($(food_row).val()) {
            for(let i = 0; i < $(food_row).length; i++) {
                food_result.push($(food_row).eq(i).val())
                portions.push($(food_row_portions).eq(i).val())
            }
            let meal = $(this).parent().parent().attr('id').replace('_frame', '')
            let form = $('#' + meal + '_form')[0]
            let formData = new FormData(form)
            formData.append('meal_img', $('#' + meal + '_fileBtn')[0].files[0])
            formData.append('date', $('#datepicker').val())
            formData.append('frame', $(food_form).attr('id'))
            formData.append('food_result', food_result)
            formData.append('portions', portions)
            formData.append('kid_id', sessionStorage.getItem('kid_id'))

            $.ajax({
                url: 'meal_diet',
                method: 'post',
                enctype: 'multipart/form-data',
                data: formData,
                contentType: false,
                processData: false,
            }).done(function(results) {
                window.location.reload()
            })
            $(this).attr('disabled', 'disabled')
            $('.' + meal + '_upload').attr('disabled', 'disabled')
            $('.' + meal + '_del_btn').removeAttr('disabled')
            $('#' + $(food_form).attr('id') + ' .del_food_btn').attr('disabled', 'disabled')
            $('#' + $(food_form).attr('id') + ' select').attr('disabled', 'disabled')
            $('#' + $(food_form).attr('id') + ' .add_food').attr('disabled', 'disabled')
        }
    })

    // 부족/과잉 영양성분 보기
    $('.breakfast_nu_result_btn').click(function() {
        $('#breakfast_nu_modal').modal('show')
    })
    $('.lunch_nu_result_btn').click(function() {
        $('#lunch_nu_modal').modal('show')
    })
    $('.dinner_nu_result_btn').click(function() {
        $('#dinner_nu_modal').modal('show')
    })
})
</script>
{% endblock %}